{"is_source_file": true, "format": "TypeScript", "description": "This file defines a Pinia store for managing offline question packs in a quiz game frontend. It includes types, utility functions, and store actions for storing, retrieving, importing, exporting, and fetching quiz question packs, as well as managing offline mode state.", "external_files": ["./quiz"], "external_methods": ["defineStore from 'pinia'", "computed and ref from 'vue'", "localStorage.getItem", "localStorage.setItem", "fetch"], "published": ["useOfflineStore"], "classes": [], "methods": [{"name": "function stableHash(str: string): string { stableHash", "description": "Generates a stable hash from a string, used for content hashing.", "scope": "", "scopeKind": ""}, {"name": "isRecord", "description": "Type guard to check if a value is a record object."}, {"name": "isRawQuestion", "description": "Type guard to validate if an object conforms to RawQuestion structure."}, {"name": "toPack", "description": "Converts raw data array into an OfflinePack containing sanitized questions and metadata."}, {"name": "readStorage", "description": "Reads offline question packs and offline-enabled flag from localStorage."}, {"name": "writeStorage", "description": "Persists offline state and packs to localStorage."}, {"name": "function clearAll() { clearAll", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function deletePack(category: CategoryKey) { deletePack", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function exportPack(category: CategoryKey): string | null { exportPack", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function fetchAndStore(category: CategoryKey): Promise<{ ok: boolean; status: string; pa/ fetchAndStore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function getPack(category: CategoryKey): OfflinePack | undefined { getPack", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function getStorageUsageSummary(): { totalQuestions: number; categories: Array<{ category: Cat/ getStorageUsageSummary", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function importPack(category: CategoryKey, json: string): { ok: boolean; error?: string } { importPack", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function savePack(category: CategoryKey, data: unknown, version = 'v1'): OfflinePack | null { savePack", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["localStorage.getItem", "localStorage.setItem", "JSON.parse", "JSON.stringify", "fetch", "Date.now()", "stableHash"], "search-terms": ["offline question packs", "pinia store for quiz", "local storage question data", "fetch questions API", "quiz question pack management"], "state": 2, "file_id": 25, "knowledge_revision": 82, "git_revision": "", "revision_history": [{"81": ""}, {"82": ""}], "ctags": [{"_type": "tag", "name": "JSON", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    return JSON.stringify(payload, null, 2)$/", "language": "TypeScript", "kind": "constant", "scope": "exportPack", "scopeKind": "function"}, {"_type": "tag", "name": "OFFLINE_FLAG_KEY", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^const OFFLINE_FLAG_KEY = 'quizmaster:offline:enabled'$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "OfflinePack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^export type OfflinePack = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "OfflinePackMeta", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^export type OfflinePackMeta = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "OfflineState", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^type OfflineState = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "STORAGE_KEY", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^const STORAGE_KEY = 'quizmaster:offline:packs'$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const base = (import.meta.env.VITE_API_BASE as string) || (import.meta.env.VITE_BACKEND_URL /", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "category", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const p = packs.value[category]$/", "language": "TypeScript", "kind": "constant", "scope": "exportPack", "scopeKind": "function"}, {"_type": "tag", "name": "clearAll", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function clearAll() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "controller", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const controller = new AbortController()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const data = await res.json()$/", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "deletePack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function deletePack(category: CategoryKey) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "enabled", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const enabled = flag ? flag === '1' : false$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "explanation", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const explanation =$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "exportPack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function exportPack(category: CategoryKey): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "fetchAndStore", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  async function fetchAndStore(category: CategoryKey): Promise<{ ok: boolean; status: string; pa/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "flag", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const enabled = flag ? flag === '1' : false$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "flag", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const flag = localStorage.getItem(OFFLINE_FLAG_KEY)$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "geography", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const packs: OfflineState['packs'] = { gk: undefined, sports: undefined, movies: undefined, /", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "getPack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function getPack(category: CategoryKey): OfflinePack | undefined {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getStorageUsageSummary", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function getStorageUsageSummary(): { totalQuestions: number; categories: Array<{ category: Cat/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "hash", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      hash: stableHash(payloadStr),$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "hint", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const hint =$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "history", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const packs: OfflineState['packs'] = { gk: undefined, sports: undefined, movies: undefined, /", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "importPack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function importPack(category: CategoryKey, json: string): { ok: boolean; error?: string } {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "k", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^        const p = src[k]$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "k", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      for (const k of Object.keys(packs) as CategoryKey[]) {$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "k", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    for (const k of categories) packs.value[k] = undefined$/", "language": "TypeScript", "kind": "constant", "scope": "clearAll", "scopeKind": "function"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const list = categories.map((c) => ({$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "movies", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const packs: OfflineState['packs'] = { gk: undefined, sports: undefined, movies: undefined, /", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const msg = (e && typeof e === 'object' && 'message' in e) ? String((e as { message?: stri/", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const msg = (e && typeof e === 'object' && 'message' in e) ? String((e as { message?: stri/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "obj", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const obj = JSON.parse(json)$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "obj", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const version = typeof obj?.meta?.version === 'string' ? obj.meta.version : 'v1'$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "obj", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const obj = JSON.parse(raw) as Partial<OfflineState>$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^        const p = src[k]$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const p = packs.value[category]$/", "language": "TypeScript", "kind": "constant", "scope": "exportPack", "scopeKind": "function"}, {"_type": "tag", "name": "pack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const pack = toPack(category, questions, version)$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "pack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const pack = toPack(category, data, version)$/", "language": "TypeScript", "kind": "constant", "scope": "savePack", "scopeKind": "function"}, {"_type": "tag", "name": "pack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  const pack: OfflinePack = {$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "pack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  return pack$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "packs", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const packs: OfflineState['packs'] = { gk: undefined, sports: undefined, movies: undefined, /", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const payload = {$/", "language": "TypeScript", "kind": "constant", "scope": "exportPack", "scopeKind": "function"}, {"_type": "tag", "name": "payloadStr", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  const payloadStr = JSON.stringify(sanitized)$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "questions", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const questions = Array.isArray(obj?.questions) ? obj.questions : obj$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "questions", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      questions: p.questions,$/", "language": "TypeScript", "kind": "constant", "scope": "exportPack", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const raw = localStorage.getItem(STORAGE_KEY)$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "referenceUrl", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const referenceUrl = typeof rq.referenceUrl === 'string' ? rq.referenceUrl : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "return", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    return JSON.stringify(payload, null, 2)$/", "language": "TypeScript", "kind": "constant", "scope": "exportPack", "scopeKind": "function"}, {"_type": "tag", "name": "return", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  return pack$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "rq", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const referenceUrl = typeof rq.referenceUrl === 'string' ? rq.referenceUrl : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "rq", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const rq = q as RawQuestion$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "rq", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const source = typeof rq.source === 'string' ? rq.source : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "savePack", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^  function savePack(category: CategoryKey, data: unknown, version = 'v1'): OfflinePack | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "saved", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const saved = savePack(category, data, 'v1')$/", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "science", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const packs: OfflineState['packs'] = { gk: undefined, sports: undefined, movies: undefined, /", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "source", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const source = typeof rq.source === 'string' ? rq.source : undefined$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "sports", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const packs: OfflineState['packs'] = { gk: undefined, sports: undefined, movies: undefined, /", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "src", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const src: Record<string, unknown> = obj.packs as Record<string, unknown>$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "stableHash", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^function stableHash(str: string): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "timeout", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const timeout = setTimeout(() => controller.abort(), 8000)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^    const url = new URL(`${base.replace(\\/\\\\\\/+$\\/, '')}\\/api\\/questions`)$/", "language": "TypeScript", "kind": "constant", "scope": "fetchAndStore", "scopeKind": "function"}, {"_type": "tag", "name": "useOfflineStore", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^export const useOfflineStore = defineStore('offline', () => {$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}, {"_type": "tag", "name": "version", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      const version = typeof obj?.meta?.version === 'string' ? obj.meta.version : 'v1'$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "version", "path": "/home/kavia/workspace/code-generation/quizmaster-web-220267-220276/quiz_game_frontend/src/stores/offline.ts", "pattern": "/^      version,$/", "language": "TypeScript", "kind": "constant", "scope": "stableHash", "scopeKind": "function"}], "hash": "85eeaf1c5b24b799284233d267b4a5e4", "format-version": 4, "code-base-name": "quiz_game_frontend", "filename": "quiz_game_frontend/src/stores/offline.ts"}